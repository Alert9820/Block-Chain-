
<!DOCTYPE html>
<html>
<head>
<title>Staff Evidence Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
    background: #0d0d0d;
    font-family: Arial, sans-serif;
    color: white;
    margin: 0;
    padding: 0;
}

h2 {
    text-align: center;
    margin-top: 15px;
    color: #00e1ff;
}

.container {
    width: 90%;
    margin: auto;
}

.card {
    background: #1b1b1b;
    padding: 18px;
    margin-top: 15px;
    border-radius: 10px;
    border: 1px solid #00e1ff;
}

input, textarea {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border-radius: 5px;
    border: none;
    outline: none;
    background: #2a2a2a;
    color: white;
}

button {
    background: #00e1ff;
    border: none;
    padding: 10px 18px;
    margin-top: 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
}

button:hover {
    background: cyan;
}

.block {
    background: #131313;
    padding: 15px;
    border-radius: 10px;
    border-left: 4px solid #00e1ff;
    margin-bottom: 10px;
}

.status {
    background: #444;
    padding: 3px 7px;
    border-radius: 5px;
    font-size: 12px;
    display: inline-block;
}

.loader {
    display:none;
    margin-top:10px;
    color:#00ffea;
}
</style>
</head>

<body>

<h2>üìÇ Evidence Submission (Staff Panel)</h2>

<div class="container">

    <div class="card">
        <label>Evidence Text:</label>
        <textarea id="text" rows="4" placeholder="Write evidence details..."></textarea>

        <label>Attach Image (optional):</label>
        <input type="file" id="img" accept="image/*">

        <button onclick="addEvidence()">Submit Evidence</button>
        <button onclick="loadBlocks()">üîÑ Refresh</button>
        <button onclick="validate()">‚úî Validate Chain</button>
        <button onclick="logout()" style="background:#ff4747; color:white;">Logout</button>

        <p id="msg" class="loader">‚è≥ Processing...</p>
    </div>

    <h3 style="margin-top:20px;">üîó Submitted Evidence</h3>
    <div id="blocks"></div>

</div>


<script>
const API = "https://block-chain-0xps.onrender.com";
const token = localStorage.getItem("token");

if(!token) window.location.href = "login.html";

async function addEvidence(){
    const msg = document.getElementById("msg");
    const text = document.getElementById("text").value;
    const img = document.getElementById("img").files[0];

    if(!text.trim()) return alert("‚ö† Please enter evidence details.");

    msg.style.display = "block";
    msg.innerText = "‚è≥ Uploading...";

    let fd = new FormData();
    fd.append("text", text);
    if(img) fd.append("image", img);

    let res = await fetch(`${API}/addBlock`, {
        method: "POST",
        headers: { "Authorization": token },
        body: fd
    });

    let data = await res.json();
    msg.style.display = "none";

    if(data.success){
        alert("‚úî Evidence Submitted");
        document.getElementById("text").value = "";
        document.getElementById("img").value = "";
        loadBlocks();
    } else {
        alert("‚ùå Failed to submit.");
    }
}

async function loadBlocks(){
    let res = await fetch(`${API}/chain/staff`,{
        headers:{ "Authorization": token }
    });

    let blocks = await res.json();
    let box = document.getElementById("blocks");
    box.innerHTML = "";

    if(blocks.length === 0){
        box.innerHTML = "<p>No evidence added yet.</p>";
        return;
    }

    blocks.forEach(b=>{
        box.innerHTML += `
        <div class="block">
            <b>Block #${b.index}</b><br>
            <small>${new Date(b.timestamp).toLocaleString()}</small>
            <p>${b.text}</p>
            <span class="status">${b.status}</span><br><br>
            <button onclick="restoreRequest(${b.index})">üìå Request Restore</button>
        </div>`;
    });
}

async function restoreRequest(index){
    let reason = prompt("Reason for restore request:");
    if(!reason) return;

    await fetch(`${API}/restore/request`,{
        method:"POST",
        headers:{ "Content-Type":"application/json", "Authorization":token },
        body:JSON.stringify({ blockIndex:index, reason })
    });

    alert("üì© Request sent to admin.");
}

async function validate(){
    let res = await fetch(`${API}/validate`,{
        headers:{ "Authorization": token }
    });

    let result = await res.json();
    alert(result.msg);
}

async function logout(){
    await fetch(`${API}/activity/logout`,{
        method:"POST",
        headers:{ "Authorization":token }
    });

    localStorage.removeItem("token");
    window.location.href="login.html";
}

loadBlocks();
</script>

</body>
</html>
