<!DOCTYPE html>
<html>
<head>
<title>üëÆ Staff Panel - Evidence Blockchain</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    background: #0b0b0b;
    color: #31e1ff;
    font-family: Arial, sans-serif;
    margin: 0;
}
header {
    background: #00222b;
    padding: 14px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
    color: #31e1ff;
    border-bottom: 2px solid #31e1ff;
}
button {
    background: #31e1ff;
    border: none;
    padding: 10px 15px;
    margin: 6px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
}
button:hover { background:#00b8cc; }
textarea, input {
    width: 92%;
    background:#1a1a1a;
    color:#31e1ff;
    border:1px solid #31e1ff;
    padding:8px;
    border-radius:6px;
	margin-top:10px;
}
#chainBox {
    padding: 15px;
}
.block {
    border: 1px solid #31e1ff;
    background: rgba(0,255,255,0.05);
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 6px;
}
.status {
    display:inline-block;
    padding:6px 10px;
    border-radius:6px;
    font-size:12px;
    margin-bottom:5px;
}
.status.valid { background:#00ff77; color:black; }
.status.frozen { background:#ffd000; color:black; }
.status.invalid { background:#ff4c4c; color:white; }
</style>
</head>

<body onload="init()">

<header>üëÆ STAFF BLOCKCHAIN EVIDENCE SYSTEM</header>

<div style="text-align:center; padding:10px;">
    <button onclick="loadChain()">üì¶ View Evidence</button>
    <button onclick="validateChain()">‚úî Validate Chain</button>
    <button onclick="logout()" style="background:#ff4d4d;color:white;">üö™ Logout</button>
</div>

<hr style="border-color:#31e1ff;">

<div style="padding:10px;">
    <h3>‚ûï Add New Evidence</h3>

    <textarea id="text" rows="4" placeholder="Enter evidence description..."></textarea>
    <input type="file" id="image" accept="image/*">

    <button onclick="addBlock()">Submit Evidence</button>
</div>

<hr style="border-color:#31e1ff;">

<h3 style="padding-left:12px;">üì¶ Saved Evidence</h3>
<div id="chainBox">Loading...</div>

<script>

const API = location.origin;
let token = localStorage.getItem("token");
if(!token) location.href="/login.html";

// üîπ Add Evidence
async function addBlock() {
	let text=document.getElementById("text").value;
	let image=document.getElementById("image").files[0];

	if(!text.trim()) return alert("Please enter description.");

	const fd=new FormData();
	fd.append("text",text);
	if(image) fd.append("image",image);

	let res=await fetch(API+"/addBlock",{
		method:"POST",
		body:fd,
		headers:{Authorization:token}
	});

	let data=await res.json();
	if(data.success){
		alert("Evidence Recorded!");
		document.getElementById("text").value="";
		document.getElementById("image").value="";
		loadChain();
	} else alert("Error Saving Block");
}

// üîπ Show Chain (NO HASH, NO IMAGE)
async function loadChain(){
	const box=document.getElementById("chainBox");
	box.innerHTML="<p style='color:yellow'>Loading...</p>";

	let res=await fetch(API+"/chain",{
		headers:{Authorization:token}
	});
	let data=await res.json();
	box.innerHTML="";

	if(!data.length) return box.innerHTML="<p>No Evidence Found.</p>";

	data.forEach(b=>{
		box.innerHTML+=`
		<div class="block">
			<div class="status ${b.status}">${b.status.toUpperCase()}</div><br>
			<b>Block #${b.index}</b><br>
			<b>Description:</b> ${b.text}<br>
			<b>Timestamp:</b> ${b.timestamp}<br><br>

			<button onclick="openRequest(${b.index})" style="background:#ffaa2b;">‚ö† Request Restore</button>
		</div>`;
	});
}

// üîπ Restore Request
async function openRequest(index){
	let reason=prompt("Why do you want to restore Block #"+index+"?");
	if(!reason) return;

	await fetch(API+"/restore/request",{
		method:"POST",
		headers:{
			"Content-Type":"application/json",
			Authorization:token
		},
		body:JSON.stringify({blockIndex:index,reason})
	});

	alert("Request sent.");
}

// üîπ Validate
async function validateChain(){
	let res=await fetch(API+"/validate",{headers:{Authorization:token}});
	let result=await res.json();
	
	if(result.valid) alert("‚úì Blockchain is Valid and Untouched.");
	else alert("‚ùå ALERT: "+result.issue);
}

// üîπ Logout
async function logout(){
	await fetch(API+"/auth/logout",{method:"POST",headers:{Authorization:token}});
	localStorage.removeItem("token");
	location.href="/login.html";
}

function init(){ loadChain(); }

</script>

</body>
</html>
