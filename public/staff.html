<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Staff Panel | Evidence Blockchain</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
 --primary:#00f7ff;
 --glow:#00ffee55;
 --danger:#ff3b53;
 --success:#00ff95;
 --warning:#ffc400;
 --bg:#020202;
}

body{
 background:var(--bg);
 color:var(--primary);
 margin:0;
 font-family:"Segoe UI",sans-serif;
}

header{
 background:rgba(0,0,0,.5);
 padding:15px;
 text-align:center;
 font-size:22px;
 box-shadow:0 0 15px var(--glow);
}

.container{
 width:92%;
 margin:auto;
 padding:20px;
}

.section{
 background:rgba(0,0,0,.4);
 border:1px solid var(--primary);
 padding:20px;
 border-radius:15px;
 box-shadow:0 0 20px var(--glow);
 margin-bottom:25px;
}

h2{
 margin-top:0;
 text-shadow:0 0 10px var(--primary);
}

textarea,input[type=file]{
 width:100%;
 background:#000;
 border:1px solid var(--primary);
 padding:10px;
 margin:10px 0;
 border-radius:8px;
 color:var(--primary);
}

button{
 padding:10px 18px;
 border:none;
 cursor:pointer;
 border-radius:20px;
 font-weight:bold;
 margin:5px;
 transition:.3s;
}

.logout-btn{ background:var(--danger); }
.action-btn{ background:var(--primary); color:black; }
.request-btn{ background:var(--warning); color:black; }

button:hover{ transform:scale(1.08); }

.block{
 border:1px solid var(--primary);
 padding:15px;
 border-radius:10px;
 margin-top:10px;
 box-shadow:0 0 15px var(--glow);
}

.badge{
 padding:5px 10px;
 border-radius:10px;
 font-size:12px;
 color:black;
 font-weight:bold;
}
.valid{background:var(--success);}
.invalid{background:var(--danger);}
.frozen{background:var(--warning);}

img.preview{
 width:100%;
 border-radius:10px;
 margin-top:10px;
 border:1px solid var(--primary);
}

#msg{
 margin-top:10px;
 font-size:14px;
}
</style>
</head>

<body>

<header>
 üßë‚Äçüíº Staff Dashboard
 <button class="logout-btn" style="float:right;" onclick="logout()">Logout</button>
</header>


<div class="container">

<!-- Add Evidence Section -->
<div class="section">
  <h2>üìå Add New Evidence</h2>

  <textarea id="text" rows="4" placeholder="Describe evidence..."></textarea>
  <input type="file" id="image" accept="image/*">

  <button class="action-btn" onclick="addEvidence()">Add Evidence</button>
</div>

<!-- Blockchain Display Section -->
<div class="section">
  <h2>üîó Blockchain</h2>

  <button class="action-btn" onclick="loadChain()">Refresh Blockchain</button>
  <div id="chain"></div>
</div>

<!-- Restore Request Section -->
<div class="section">
  <h2>üì© Request Evidence Restore</h2>

  <input type="number" id="restoreIndex" placeholder="Block number to request">
  <textarea id="reason" placeholder="Why restore?" rows="3"></textarea>

  <button class="request-btn" onclick="sendRequest()">Send Request</button>
</div>

<p id="msg"></p>
</div>


<script>
const API="https://block-chain-0xps.onrender.com";
const token=localStorage.getItem("token");
const role=localStorage.getItem("role");

// Access Control
if(!token || role!=="staff"){
  alert("‚ùå Access Denied");
  window.location="login.html";
}

// Logout
function logout(){
  localStorage.clear();
  window.location="login.html";
}

// Add Evidence
async function addEvidence(){
  const text=document.getElementById("text").value;
  const img=document.getElementById("image").files[0];

  if(!text.trim()) return setMsg("‚ö† Enter evidence text");

  let fd=new FormData();
  fd.append("text",text);
  if(img) fd.append("image",img);

  await fetch(API+"/addBlock",{ method:"POST", body:fd });
  setMsg("‚úî Evidence added");
  document.getElementById("text").value="";
  document.getElementById("image").value="";
  loadChain();
}

// Show Blockchain
async function loadChain(){
  const res=await fetch(API+"/chain");
  const data=await res.json();

  let html="";
  data.forEach(b=>{
    html+=`
    <div class="block">
      <b>Block #${b.index}</b><br>
      Status: <span class="badge ${b.status}">${b.status}</span><br>
      Text: ${b.text}<br>
      Hash: ${b.hash}<br>
      Previous: ${b.previousHash}<br>
    </div>`;
  });

  document.getElementById("chain").innerHTML=html || "No blocks yet.";
}

// Send Restore Request
async function sendRequest(){
  const blockIndex=document.getElementById("restoreIndex").value;
  const reason=document.getElementById("reason").value;

  if(!blockIndex || !reason) return setMsg("‚ö† Fill required fields");

  await fetch(API+"/restore/request",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      authorization:token
    },
    body:JSON.stringify({blockIndex,reason})
  });

  setMsg("üì© Restore request sent");
  document.getElementById("restoreIndex").value="";
  document.getElementById("reason").value="";
}

// Set Status
function setMsg(msg){ document.getElementById("msg").innerHTML=msg; }

loadChain();
</script>
</body>
</html>
