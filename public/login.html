<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login | Evidence Blockchain System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
 --primary:#00f7ff;
 --glow:#00ffee50;
 --danger:#ff3b53;
 --success:#00ff72;
 --bg:#020202;
}

body{
  background:var(--bg);
  color:var(--primary);
  font-family: 'Segoe UI', sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}

.container{
  width:300px;
  background:rgba(0,0,0,.5);
  border:1px solid var(--primary);
  padding:25px;
  border-radius:15px;
  box-shadow:0 0 25px var(--glow);
  text-align:center;
}

h1{
 font-size:22px;
 margin-bottom:15px;
 text-shadow:0 0 15px var(--primary);
}

input{
 width:100%;
 padding:10px;
 margin:10px 0;
 background:#000;
 border:1px solid var(--primary);
 border-radius:8px;
 color:var(--primary);
}

button{
 width:100%;
 padding:12px;
 background:var(--primary);
 color:black;
 border:none;
 border-radius:25px;
 font-weight:bold;
 cursor:pointer;
 margin-top:10px;
 box-shadow:0 0 10px var(--glow);
 transition:0.3s;
}

button:hover{ transform:scale(1.05); }

#msg{
 margin-top:10px;
 font-size:14px;
 height:18px;
}
</style>
</head>

<body>

<div class="container">
 <h1>üîê Login</h1>

 <input type="text" id="username" placeholder="Enter Username">
 <input type="password" id="password" placeholder="Enter Password">

 <button id="loginBtn" onclick="login()">Login</button>

 <p id="msg"></p>
</div>

<script>
const API="https://block-chain-0xps.onrender.com";

// üî• Auto redirect if already logged in
window.onload = () => {
  const token = localStorage.getItem("token");
  const role = localStorage.getItem("role");

  if(token && role){
    if(role==="admin") window.location="admin.html";
    else window.location="staff.html";
  }
};

// LOGIN FUNCTION
async function login(){
  const user=document.getElementById("username").value.trim();
  const pass=document.getElementById("password").value.trim();
  const msg=document.getElementById("msg");
  const btn=document.getElementById("loginBtn");

  if(!user || !pass){
    msg.innerHTML="‚ö† Please enter credentials";
    return;
  }

  btn.disabled=true;
  btn.innerText="Processing...";

  const res = await fetch(API+"/auth/login",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({username:user,password:pass})
  });

  const data=await res.json();

  if(data.error){
    msg.style.color="var(--danger)";
    msg.innerHTML="‚ùå "+data.error;
    btn.disabled=false;
    btn.innerText="Login";
    return;
  }

  // Success
  msg.style.color="var(--success)";
  msg.innerHTML="‚úî Login Successful";

  localStorage.setItem("token",data.token);
  localStorage.setItem("role",data.role);

  setTimeout(()=>{
    if(data.role==="admin") window.location="admin.html";
    else window.location="staff.html";
  },700);
}
</script>
</body>
</html>
